function js_beautify(d,A){var c,D,q,R,m,x,B,u,e,aa;var G,X,g,o,v,Z;var P,V,F;var S,ad,k;var ac="";A=A?A:{};var Q;if(A.space_after_anon_function!==undefined&&A.jslint_happy===undefined){A.jslint_happy=A.space_after_anon_function}if(A.braces_on_own_line!==undefined){Q=A.braces_on_own_line?"expand":"collapse"}Q=A.brace_style?A.brace_style:(Q?Q:"collapse");var J=A.indent_size?A.indent_size:1;var j=A.indent_char?A.indent_char:"\t";var U=typeof A.preserve_newlines==="undefined"?false:A.preserve_newlines;var y=typeof A.max_preserve_newlines==="undefined"?true:A.max_preserve_newlines;var r=A.jslint_happy==="undefined"?false:A.jslint_happy;var l=typeof A.keep_array_indentation==="undefined"?false:A.keep_array_indentation;ad=false;var w=d.length;function s(i){i=typeof i==="undefined"?false:i;while(D.length&&(D[D.length-1]===" "||D[D.length-1]===aa||D[D.length-1]===ac||(i&&(D[D.length-1]==="\n"||D[D.length-1]==="\r")))){D.pop()}}function a(i){return i.replace(/^\s\s*|\s\s*$/,"")}function h(){var i=l;l=false;C();l=i}function C(ae){u.eat_next_space=false;if(l&&M(u.mode)){return}ae=typeof ae==="undefined"?true:ae;u.if_line=false;s();if(!D.length){return}if(D[D.length-1]!=="\n"||!ae){ad=true;D.push("\n")}if(ac){D.push(ac)}for(var t=0;t<u.indentation_level;t+=1){D.push(aa)}if(u.var_line&&u.var_line_reindented){D.push(aa)}}function z(){if(u.eat_next_space){u.eat_next_space=false;return}var i=" ";if(D.length){i=D[D.length-1]}if(i!==" "&&i!=="\n"&&i!==aa){D.push(" ")}}function I(){ad=false;u.eat_next_space=false;D.push(q)}function p(){u.indentation_level+=1}function O(){if(D.length&&D[D.length-1]===aa){D.pop()}}function n(i){if(u){e.push(u)}u={previous_mode:u?u.mode:"BLOCK",mode:i,var_line:false,var_line_tainted:false,var_line_reindented:false,in_html_comment:false,if_line:false,in_case:false,eat_next_space:false,indentation_baseline:-1,indentation_level:(u?u.indentation_level+((u.var_line&&u.var_line_reindented)?1:0):0),ternary_depth:0}}function M(i){return i==="[EXPRESSION]"||i==="[INDENTED-EXPRESSION]"}function E(i){return i==="[EXPRESSION]"||i==="[INDENTED-EXPRESSION]"||i==="(EXPRESSION)"}function f(){F=u.mode==="DO_BLOCK";if(e.length>0){u=e.pop()}}function ab(t,af){for(var ae=0;ae<t.length;ae++){if(a(t[ae])[0]!=af){return false}}return true}function K(af,t){for(var ae=0;ae<t.length;ae+=1){if(t[ae]===af){return true}}return false}function W(){k=0;if(o>=w){return["","TK_EOF"]}S=false;var am=c.charAt(o);o+=1;var ao=l&&M(u.mode);if(ao){var ag=0;while(K(am,G)){if(am==="\n"){s();D.push("\n");ad=true;ag=0}else{if(am==="\t"){ag+=4}else{if(am==="\r"){}else{ag+=1}}}if(o>=w){return["","TK_EOF"]}am=c.charAt(o);o+=1}if(u.indentation_baseline===-1){u.indentation_baseline=ag}if(ad){var ai;for(ai=0;ai<u.indentation_level+1;ai+=1){D.push(aa)}if(u.indentation_baseline!==-1){for(ai=0;ai<ag-u.indentation_baseline;ai++){D.push(" ")}}}}else{while(K(am,G)){if(am==="\n"){k+=((y)?(k<=y)?1:0:1)}if(o>=w){return["","TK_EOF"]}am=c.charAt(o);o+=1}if(U){if(k>1){for(ai=0;ai<k;ai+=1){C(ai===0);ad=true}}}S=k>0}if(K(am,X)){if(o<w){while(K(c.charAt(o),X)){am+=c.charAt(o);o+=1;if(o===w){break}}}if(o!==w&&am.match(/^[0-9]+[Ee]$/)&&(c.charAt(o)==="-"||c.charAt(o)==="+")){var af=c.charAt(o);o+=1;var ap=W(o);am+=af+ap[0];return[am,"TK_WORD"]}if(am==="in"){return[am,"TK_OPERATOR"]}if(S&&R!=="TK_OPERATOR"&&R!=="TK_EQUALS"&&!u.if_line&&(U||m!=="var")){C()}return[am,"TK_WORD"]}if(am==="("||am==="["){return[am,"TK_START_EXPR"]}if(am===")"||am==="]"){return[am,"TK_END_EXPR"]}if(am==="{"){return[am,"TK_START_BLOCK"]}if(am==="}"){return[am,"TK_END_BLOCK"]}if(am===";"){return[am,"TK_SEMICOLON"]}if(am==="/"){var aj="";var an=true;if(c.charAt(o)==="*"){o+=1;if(o<w){while(!(c.charAt(o)==="*"&&c.charAt(o+1)&&c.charAt(o+1)==="/")&&o<w){am=c.charAt(o);aj+=am;if(am==="\x0d"||am==="\x0a"){an=false}o+=1;if(o>=w){break}}}o+=2;if(an){return["/*"+aj+"*/","TK_INLINE_COMMENT"]}else{return["/*"+aj+"*/","TK_BLOCK_COMMENT"]}}if(c.charAt(o)==="/"){aj=am;while(c.charAt(o)!=="\r"&&c.charAt(o)!=="\n"){aj+=c.charAt(o);o+=1;if(o>=w){break}}o+=1;if(S){C()}return[aj,"TK_COMMENT"]}}if(am==="'"||am==='"'||(am==="/"&&((R==="TK_WORD"&&K(m,["return","do"]))||(R==="TK_COMMENT"||R==="TK_START_EXPR"||R==="TK_START_BLOCK"||R==="TK_END_BLOCK"||R==="TK_OPERATOR"||R==="TK_EQUALS"||R==="TK_EOF"||R==="TK_SEMICOLON")))){var aq=am;var al=false;var ae=am;if(o<w){if(aq==="/"){var ak=false;while(al||ak||c.charAt(o)!==aq){ae+=c.charAt(o);if(!al){al=c.charAt(o)==="\\";if(c.charAt(o)==="["){ak=true}else{if(c.charAt(o)==="]"){ak=false}}}else{al=false}o+=1;if(o>=w){return[ae,"TK_STRING"]}}}else{while(al||c.charAt(o)!==aq){ae+=c.charAt(o);if(!al){al=c.charAt(o)==="\\"}else{al=false}o+=1;if(o>=w){return[ae,"TK_STRING"]}}}}o+=1;ae+=aq;if(aq==="/"){while(o<w&&K(c.charAt(o),X)){ae+=c.charAt(o);o+=1}}return[ae,"TK_STRING"]}if(am==="#"){if(D.length===0&&c.charAt(o)==="!"){ae=am;while(o<w&&am!="\n"){am=c.charAt(o);ae+=am;o+=1}D.push(a(ae)+"\n");C();return W()}var ah="#";if(o<w&&K(c.charAt(o),Z)){do{am=c.charAt(o);ah+=am;o+=1}while(o<w&&am!=="#"&&am!=="=");if(am==="#"){}else{if(c.charAt(o)==="["&&c.charAt(o+1)==="]"){ah+="[]";o+=2}else{if(c.charAt(o)==="{"&&c.charAt(o+1)==="}"){ah+="{}";o+=2}}}return[ah,"TK_WORD"]}}if(am==="<"&&c.substring(o-1,o+3)==="<!--"){o+=3;u.in_html_comment=true;return["<!--","TK_COMMENT"]}if(am==="-"&&u.in_html_comment&&c.substring(o-1,o+2)==="-->"){u.in_html_comment=false;o+=2;if(S){C()}return["-->","TK_COMMENT"]}if(K(am,g)){while(o<w&&K(am+c.charAt(o),g)){am+=c.charAt(o);o+=1;if(o>=w){break}}if(am==="="){return[am,"TK_EQUALS"]}else{return[am,"TK_OPERATOR"]}}return[am,"TK_UNKNOWN"]}aa="";while(J>0){aa+=j;J-=1}while(d&&(d[0]===" "||d[0]==="\t")){ac+=d[0];d=d.substring(1)}c=d;B="";R="TK_START_EXPR";m="";x="";D=[];F=false;G="\n\r\t ".split("");X="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");Z="0123456789".split("");g="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::";g+=" <%= <% %> <?= <? ?>";g=g.split(" ");v="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(",");e=[];n("BLOCK");o=0;while(true){var T=W(o);q=T[0];V=T[1];if(V==="TK_EOF"){break}switch(V){case"TK_START_EXPR":if(q==="["){if(R==="TK_WORD"||m===")"){if(K(m,v)){z()}n("(EXPRESSION)");I();break}if(u.mode==="[EXPRESSION]"||u.mode==="[INDENTED-EXPRESSION]"){if(x==="]"&&m===","){if(u.mode==="[EXPRESSION]"){u.mode="[INDENTED-EXPRESSION]";if(!l){p()}}n("[EXPRESSION]");if(!l){C()}}else{if(m==="["){if(u.mode==="[EXPRESSION]"){u.mode="[INDENTED-EXPRESSION]";if(!l){p()}}n("[EXPRESSION]");if(!l){C()}}else{n("[EXPRESSION]")}}}else{n("[EXPRESSION]")}}else{n("(EXPRESSION)")}if(m===";"||R==="TK_START_BLOCK"){C()}else{if(R==="TK_END_EXPR"||R==="TK_START_EXPR"||R==="TK_END_BLOCK"||m==="."){}else{if(R!=="TK_WORD"&&R!=="TK_OPERATOR"){z()}else{if(B==="function"||B==="typeof"){if(r){z()}}else{if(K(m,v)||m==="catch"){z()}}}}}I();break;case"TK_END_EXPR":if(q==="]"){if(l){if(m==="}"){O();I();f();break}}else{if(u.mode==="[INDENTED-EXPRESSION]"){if(m==="]"){f();C();I();break}}}}f();I();break;case"TK_START_BLOCK":if(B==="do"){n("DO_BLOCK")}else{n("BLOCK")}if(Q=="expand"){if(R!=="TK_OPERATOR"){if(m==="return"||m==="="){z()}else{C(true)}}I();p()}else{if(R!=="TK_OPERATOR"&&R!=="TK_START_EXPR"){if(R==="TK_START_BLOCK"){C()}else{z()}}else{if(M(u.previous_mode)&&m===","){if(x==="}"){z()}else{C()}}}p();I()}break;case"TK_END_BLOCK":f();if(Q=="expand"){if(m!=="{"){C()}I()}else{if(R==="TK_START_BLOCK"){if(ad){O()}else{s()}}else{if(M(u.mode)&&l){l=false;C();l=true}else{C()}}I()}break;case"TK_WORD":if(F){z();I();z();F=false;break}if(q==="function"){if(u.var_line){u.var_line_reindented=true}if((ad||m===";")&&m!=="{"){k=ad?k:0;if(!U){k=1}for(var Y=0;Y<2-k;Y++){C(false)}}}if(q==="case"||q==="default"){if(m===":"){O()}else{u.indentation_level--;C();u.indentation_level++}I();u.in_case=true;break}P="NONE";if(R==="TK_END_BLOCK"){if(!K(q.toLowerCase(),["else","catch","finally"])){P="NEWLINE"}else{if(Q=="expand"||Q=="end-expand"){P="NEWLINE"}else{P="SPACE";z()}}}else{if(R==="TK_SEMICOLON"&&(u.mode==="BLOCK"||u.mode==="DO_BLOCK")){P="NEWLINE"}else{if(R==="TK_SEMICOLON"&&E(u.mode)){P="SPACE"}else{if(R==="TK_STRING"){P="NEWLINE"}else{if(R==="TK_WORD"){if(m==="else"){s(true)}P="SPACE"}else{if(R==="TK_START_BLOCK"){P="NEWLINE"}else{if(R==="TK_END_EXPR"){z();P="NEWLINE"}}}}}}}if(K(q,v)&&m!==")"){if(m=="else"){P="SPACE"}else{P="NEWLINE"}}if(u.if_line&&R==="TK_END_EXPR"){u.if_line=false}if(K(q.toLowerCase(),["else","catch","finally"])){if(R!=="TK_END_BLOCK"||Q=="expand"||Q=="end-expand"){C()}else{s(true);z()}}else{if(P==="NEWLINE"){if((R==="TK_START_EXPR"||m==="="||m===",")&&q==="function"){}else{if(q==="function"&&m=="new"){z()}else{if(m==="return"||m==="throw"){z()}else{if(R!=="TK_END_EXPR"){if((R!=="TK_START_EXPR"||q!=="var")&&m!==":"){if(q==="if"&&B==="else"&&m!=="{"){z()}else{u.var_line=false;u.var_line_reindented=false;C()}}}else{if(K(q,v)&&m!=")"){u.var_line=false;u.var_line_reindented=false;C()}}}}}}else{if(M(u.mode)&&m===","&&x==="}"){C()}else{if(P==="SPACE"){z()}}}}I();B=q;if(q==="var"){u.var_line=true;u.var_line_reindented=false;u.var_line_tainted=false}if(q==="if"){u.if_line=true}if(q==="else"){u.if_line=false}break;case"TK_SEMICOLON":I();u.var_line=false;u.var_line_reindented=false;if(u.mode=="OBJECT"){u.mode="BLOCK"}break;case"TK_STRING":if(R==="TK_START_BLOCK"||R==="TK_END_BLOCK"||R==="TK_SEMICOLON"){C()}else{if(R==="TK_WORD"){z()}}I();break;case"TK_EQUALS":if(u.var_line){u.var_line_tainted=true}z();I();z();break;case"TK_OPERATOR":var b=true;var H=true;if(u.var_line&&q===","&&(E(u.mode))){u.var_line_tainted=false}if(u.var_line){if(q===","){if(u.var_line_tainted){I();u.var_line_reindented=true;u.var_line_tainted=false;C();break}else{u.var_line_tainted=false}}}if(m==="return"||m==="throw"){z();I();break}if(q===":"&&u.in_case){I();C();u.in_case=false;break}if(q==="::"){I();break}if(q===","){if(u.var_line){if(u.var_line_tainted){I();C();u.var_line_tainted=false}else{I();z()}}else{if(R==="TK_END_BLOCK"&&u.mode!=="(EXPRESSION)"){I();if(u.mode==="OBJECT"&&m==="}"){C()}else{z()}}else{if(u.mode==="OBJECT"){I();C()}else{I();z()}}}break}else{if(K(q,["--","++","!"])||(K(q,["-","+"])&&(K(R,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||K(m,v)))){b=false;H=false;if(m===";"&&E(u.mode)){b=true}if(R==="TK_WORD"&&K(m,v)){b=true}if(u.mode==="BLOCK"&&(m==="{"||m===";")){C()}}else{if(q==="."){b=false}else{if(q===":"){if(u.ternary_depth==0){u.mode="OBJECT";b=false}else{u.ternary_depth-=1}}else{if(q==="?"){u.ternary_depth+=1}}}}}if(b){z()}I();if(H){z()}if(q==="!"){}break;case"TK_BLOCK_COMMENT":var L=q.split(/\x0a|\x0d\x0a/);if(ab(L.slice(1),"*")){C();D.push(L[0]);for(Y=1;Y<L.length;Y++){C();D.push(" ");D.push(a(L[Y]))}}else{if(L.length>1){C();s()}else{z()}for(Y=0;Y<L.length;Y++){D.push(L[Y]);D.push("\n")}}C();break;case"TK_INLINE_COMMENT":z();I();if(E(u.mode)){z()}else{h()}break;case"TK_COMMENT":if(S){C()}else{z()}I();h();break;case"TK_UNKNOWN":if(m==="return"||m==="throw"){z()}I();break}x=m;R=V;m=q}var N=ac+D.join("").replace(/[\n ]+$/,"");return N}if(typeof exports!=="undefined"){exports.js_beautify=js_beautify};